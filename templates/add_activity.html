<form id="activityForm">
  <label for="activity">Aktywność:</label>
  <input id="activity" name="activity" required>

  <label for="calories">Spalone kalorie:</label>
  <input id="calories" name="calories_burned" type="number" step="0.1" required>

  <button type="submit">Dodaj aktywność</button>
</form>

<div id="result"></div>

<script>
// Funkcja do pobrania CSRF tokena z ciasteczek
function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== '') {
    const cookies = document.cookie.split(';');
    for (let i = 0; i < cookies.length; i++) {
      const cookie = cookies[i].trim();
      if (cookie.substring(0, name.length + 1) === (name + '=')) {
        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
        break;
      }
    }
  }
  return cookieValue;
}

document.getElementById("activityForm").addEventListener("submit", function(e) {
  e.preventDefault();

  const activity = document.getElementById("activity").value;
  const calories = parseFloat(document.getElementById("calories").value);

  fetch("/api/add-activity/", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "X-CSRFToken": getCookie('csrftoken')  // CSRF token
    },
    body: JSON.stringify({ activity, calories_burned: calories })
  })
  .then(res => {
    if (res.status === 403 || res.status === 401) {
      // Nie zalogowany → przekieruj do logowania
      window.location.href = '/accounts/login/?next=/add-activity-form/';
      throw new Error('Nieautoryzowany dostęp, zaloguj się');
    }
    if (!res.ok) throw new Error("Błąd: " + res.status);
    return res.json();
  })
  .then(data => {
    document.getElementById("result").innerText = "✅ Aktywność dodana: " + JSON.stringify(data);
    // opcjonalnie wyczyść formularz
    document.getElementById("activityForm").reset();
  })
  .catch(err => {
    document.getElementById("result").innerText = "❌ Błąd: " + err.message;
  });
});
</script>
